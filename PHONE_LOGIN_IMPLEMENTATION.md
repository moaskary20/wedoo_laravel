# تطبيق تسجيل الدخول برقم الهاتف وكلمة المرور

## التغييرات المنجزة

### 1. تطبيق الموبايل (Flutter)
تم تعديل ملف `handyman_app/lib/screens/login_screen.dart`:

- **السطر 369**: تم تغيير `'email': _phoneController.text.trim()` إلى `'phone': _phoneController.text.trim()`
- الآن يرسل التطبيق رقم الهاتف في حقل `phone` بدلاً من `email`

### 2. الـ Backend (Laravel)
تم تعديل ملف `wedoo_admin_panel/app/Http/Controllers/Api/AuthController.php`:

#### في دالة `login()`:
- **السطر 16**: تم تغيير `'email' => 'required|email'` إلى `'phone' => 'required|string'`
- **السطر 20**: تم تغيير `User::where('email', $request->email)` إلى `User::where('phone', $request->phone)`
- **السطر 31-46**: تم تحسين استجابة API لتتضمن البيانات المطلوبة من التطبيق

## كيفية عمل النظام الآن

1. **المستخدم يدخل رقم الهاتف وكلمة المرور** في تطبيق الموبايل
2. **التطبيق يرسل البيانات** إلى `/api/auth/login` مع:
   ```json
   {
     "phone": "01xxxxxxxxx",
     "password": "كلمة المرور"
   }
   ```
3. **الـ Backend يتحقق** من رقم الهاتف وكلمة المرور في قاعدة البيانات
4. **عند النجاح**، يعيد البيانات التالية:
   ```json
   {
     "success": true,
     "data": {
       "id": 1,
       "name": "اسم المستخدم",
       "email": "email@example.com",
       "phone": "01xxxxxxxxx",
       "governorate": "المحافظة",
       "city": "المدينة",
       "district": "المنطقة",
       "membership_code": "كود العضوية",
       "access_token": "token_here",
       "refresh_token": "token_here"
     },
     "message": "Login successful"
   }
   ```

## قاعدة البيانات

جدول `users` يحتوي على الحقول التالية:
- `phone` - رقم الهاتف (مطلوب لتسجيل الدخول)
- `password` - كلمة المرور (مشفرة)
- `name` - اسم المستخدم
- `email` - البريد الإلكتروني
- `governorate` - المحافظة
- `city` - المدينة
- `district` - المنطقة
- `membership_code` - كود العضوية
- `user_type` - نوع المستخدم (customer, craftsman, admin)
- `status` - حالة المستخدم (active, inactive, suspended)

## التحقق من صحة رقم الهاتف

التطبيق يتحقق من صحة رقم الهاتف المصري باستخدام النمط: `^01[0-9]{9}$`

## ملاحظات مهمة

1. **رقم الهاتف مطلوب** لتسجيل الدخول
2. **كلمة المرور مطلوبة** ويجب أن تكون صحيحة
3. **التحقق من صحة البيانات** يتم في الـ backend
4. **الاستجابة** تحتوي على جميع البيانات المطلوبة للتطبيق
5. **الـ Token** يتم إنشاؤه وإرساله للمستخدم المسجل دخوله

## اختبار النظام

لاختبار النظام:
1. تأكد من تشغيل الـ backend
2. قم بتشغيل تطبيق الموبايل
3. أدخل رقم هاتف صحيح (مثل: 01234567890)
4. أدخل كلمة المرور
5. اضغط على "تسجيل الدخول"

## استكشاف الأخطاء

إذا واجهت مشاكل:
1. تأكد من أن الـ backend يعمل على `http://192.168.1.44:8000`
2. تأكد من أن رقم الهاتف موجود في قاعدة البيانات
3. تأكد من أن كلمة المرور صحيحة
4. تحقق من logs في الـ backend للتأكد من استلام الطلبات
